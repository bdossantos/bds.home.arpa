---
homeassistant:
  auth_providers:
    - type: homeassistant
  latitude: !secret home_latitude
  longitude: !secret home_longitude
  elevation: 30
  unit_system: metric
  country: FR
  currency: EUR
  time_zone: Europe/Paris
  name: BDS Home
  external_url: !secret external_url
  customize: !include_dir_merge_named customize

logger:
  default: warning
  logs:
    homeassistant.components.http.ban: warning
    # HomeKit logging for better debugging and monitoring
    homeassistant.components.homekit: info
    homeassistant.components.homekit.accessories: warning
    homeassistant.components.homekit.util: warning
    pyhap: warning

system_health:

frontend:
  themes: !include_dir_merge_named themes

lovelace:
  mode: yaml
  dashboards:
    lovelace-home:
      mode: yaml
      filename: ui-lovelace.yaml
      title: Home Dashboard
      icon: mdi:home
      show_in_sidebar: true
      require_admin: false

config:

http:
  server_port: 8123
  ip_ban_enabled: "True"
  login_attempts_threshold: 3
  use_x_forwarded_for: true
  trusted_proxies:
    - 127.0.0.1
    - 172.10.0.1
    - ::1
    - 10.92.64.1
    - 10.92.64.254

history:

logbook:

prometheus:
  filter:
    include_entity_globs:
      - sensor.*_temperature
      - sensor.*_luminance
      - sensor.ups_*

sun:

tts:
  - platform: google_translate
    cache: true
    cache_dir: /tmp/tts
    time_memory: 300
    language: "en"

recorder:

scene: !include_dir_list scene

light: !include_dir_merge_list light

person: !include_dir_merge_list person

sensor: !include_dir_merge_list sensor

binary_sensor: !include_dir_merge_list binary_sensor

device_tracker: !include_dir_merge_list device_tracker

homekit:
  # Network configuration for HomeKit bridge
  advertise_ip: 10.92.64.3
  port: 21063

  # HomeKit device name and identifier
  name: BDS Home Assistant

  # Enable safe mode for better reliability
  safe_mode: true

  # Automatic start after Home Assistant startup
  auto_start: true

  # Enhanced entity filtering for better HomeKit experience
  filter:
    # Exclude entity patterns that shouldn't appear in HomeKit
    exclude_entity_globs:
      - light.*_lights # Exclude light groups (will include individual lights)
      - sensor.*_battery # Exclude battery sensors for cleaner interface
      - automation.*
      - script.all_lights_off # Exclude basic script (use scenes instead)
      - script.morning # Exclude basic script (use scenes instead)
      - group.*

    # Include specific domains that work well with HomeKit
    include_domains:
      - camera
      - switch # Add switches for smart plugs and controls
      - scene # Include scenes for HomeKit automation

    # Include specific entity patterns
    include_entity_globs:
      - light.bedroom*
      - light.hall* # Fix hallway pattern to match actual entities
      - light.lightstripkitchen*
      - light.livingroom*
      - media_player.living_room*
      - binary_sensor.*_motion # Include motion sensors
      - sensor.*_temperature # Include temperature sensors
      - sensor.*_illuminance # Include light sensors
      - scene.good_* # Include good morning/night scenes
      - scene.movie_* # Include movie time scene
      - scene.candle_* # Include candle light scene
      - scene.welcome_* # Include welcome home scene
      - scene.energy_* # Include energy save scene
      - scene.all_* # Include all off scene
      - script.homekit_* # Include HomeKit-specific scripts

    # Include specific useful entities
    include_entities:
      - input_boolean.guest_mode
      - input_boolean.vacation_mode
      - media_player.living_room
      - person.benjamin
      - person.gf
      - switch.hot_water_cylinder # Water heater control

  # Enhanced entity configuration for better HomeKit presentation
  entity_config:
    # Camera configuration with optimized streaming
    camera.cam01:
      name: Security Camera
      video_codec: copy
      support_audio: true
      video_map: 0:0 # Use first video stream
      audio_map: 0:1 # Use first audio stream
      max_fps: 30
      max_width: 1920
      max_height: 1080

    # Media player with enhanced features
    media_player.living_room:
      name: Living Room TV
      feature_list:
        - feature: on_off
        - feature: play_pause
        - feature: play_stop
        - feature: toggle_mute

    # Light configurations with proper HomeKit names
    light.bedroom2:
      name: Bedroom Side Light 1
    light.bedroom3:
      name: Bedroom Side Light 2
    light.hall1:
      name: Hallway Light
    light.lightstripkitchen1:
      name: Kitchen Strip Light
    light.livingroom1:
      name: Living Room Light

    # Input boolean configurations
    input_boolean.guest_mode:
      name: Guest Mode
    input_boolean.vacation_mode:
      name: Vacation Mode

    # Switch configurations
    switch.hot_water_cylinder:
      name: Water Heater

    # Motion sensor configurations
    binary_sensor.hue_motion_sensor_hallway_motion:
      name: Hallway Motion
    binary_sensor.hue_motion_sensor_kitchen_motion:
      name: Kitchen Motion

    # Temperature sensor configurations
    sensor.hue_motion_sensor_hallway_temperature:
      name: Hallway Temperature
    sensor.hue_motion_sensor_kitchen_temperature:
      name: Kitchen Temperature

    # Light sensor configurations
    sensor.hue_motion_sensor_hallway_illuminance:
      name: Hallway Light Level
    sensor.hue_motion_sensor_kitchen_illuminance:
      name: Kitchen Light Level

    # Person tracking (for HomeKit automation triggers)
    person.benjamin:
      name: Benjamin
    person.gf:
      name: Partner

    # Scene configurations for HomeKit
    scene.good_morning:
      name: Good Morning
    scene.good_night:
      name: Good Night
    scene.movie_time:
      name: Movie Time
    scene.candle_light:
      name: Candle Light
    scene.welcome_home:
      name: Welcome Home
    scene.energy_save:
      name: Energy Save
    scene.all_off:
      name: All Off

group:
  default_view:
    name: Home
    icon: mdi:home
    entities:
      - group.family
      - group.input_booleans
      - group.hall
      - group.toilet
      - group.kitchen
      - group.livingroom
      - group.bedroom
      - group.scenes
  sensor_view:
    name: Sensors
    icon: mdi:thermometer
    entities:
      - group.ups
  system_view:
    name: System
    icon: mdi:toolbox
    entities:
      - group.all_automations
      - group.all_scripts

  bedroom:
    name: Bedroom
    entities:
      - light.bedroom2
      - light.bedroom3
  hall:
    name: Hall
    entities:
      - light.hall1
      - binary_sensor.hue_motion_sensor_hallway_motion
      - sensor.hue_motion_sensor_hallway_illuminance
      - sensor.hue_motion_sensor_hallway_temperature
  toilet:
    name: Toilet
    entities:
      - switch.hot_water_cylinder
      - sensor.hot_water_cylinder_current_consumption
      - sensor.hot_water_cylinder_today_s_consumption
      - sensor.hot_water_cylinder_total_consumption
      - sensor.hot_water_cylinder_voltage
  kitchen:
    name: Kitchen
    entities:
      - light.lightstripkitchen1
      - binary_sensor.hue_motion_sensor_kitchen_motion
      - sensor.hue_motion_sensor_kitchen_illuminance
      - sensor.hue_motion_sensor_kitchen_temperature
  livingroom:
    name: Living Room
    entities:
      - light.livingroom1
      - media_player.living_room
      - sensor.ups_input_voltage
      - sensor.ups_load

  ups:
    name: APC BE700G
    entities:
      - sensor.ups_status
      - sensor.ups_battery_charge
      - sensor.ups_battery_runtime
      - sensor.ups_battery_voltage
      - sensor.ups_beeper_status
      - sensor.ups_input_voltage
      - sensor.ups_load
  input_booleans:
    name: Home modes
    entities:
      - input_boolean.vacation_mode
      - input_boolean.guest_mode
  family:
    name: Family
    entities:
      - person.benjamin
      - person.gf
  all_media_players:
    name: All media players
    entities:
      - media_player.living_room
      - media_player.tv
  all_switchs:
    name: All switchs
    entities:

input_select:
  benjamin_status_dropdown:
    name: Benjamin
    options:
      - Home
      - Just Arrived
      - Just Left
      - Away
      - Extended Away
    initial: Home

automation: !include_dir_merge_list automation

script: !include_dir_merge_named script

input_boolean: !include input_boolean.yaml

mobile_app:

ios:

notify:
  - name: all_smartphones
    platform: group
    services:
      - service: mobile_app_fecc7fb1_7194_4a02_90c5_cc19ee34d9e9

zone:
  - name: Work
    latitude: !secret work_latitude
    longitude: !secret work_longitude
    icon: mdi:briefcase
    radius: 100
